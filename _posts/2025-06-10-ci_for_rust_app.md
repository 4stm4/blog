---
layout: post
title:  "–¢–µ—Å—Ç–∏—Ä—É–µ–º Rust-–ø—Ä–æ–µ–∫—Ç—ã —Å –ø–æ–º–æ—â—å—é Docker –∏ Makefile"
date:   2025-06-10 09:09:00 +0500
categories: rust, docker, cargo
---


##  –¢–µ—Å—Ç–∏—Ä—É–µ–º Rust-–ø—Ä–æ–µ–∫—Ç—ã —Å –ø–æ–º–æ—â—å—é Docker –∏ Makefile

–ö–æ–≥–¥–∞ –ø—Ä–æ–µ–∫—Ç —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è —á–∞—Å—Ç—å—é CI/CD-–ø–∞–π–ø–ª–∞–π–Ω–∞ –∏–ª–∏ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ –≥–µ—Ç–µ—Ä–æ–≥–µ–Ω–Ω–æ–π —Å—Ä–µ–¥–µ, —É–¥–æ–±–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—É—é —Å—Ä–µ–¥—É –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è**, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å —Ä–∞–∑–ª–∏—á–∏–π –≤ –≤–µ—Ä—Å–∏—è—Ö Rust –∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è—Ö. –ù–∏–∂–µ ‚Äî –ø—Ä–∏–º–µ—Ä —Ç–æ–≥–æ, –∫–∞–∫ —ç—Ç–æ –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å —Å –ø–æ–º–æ—â—å—é `Docker` –∏ `Makefile`.

---

### üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```txt
project-root/
‚îú‚îÄ‚îÄ Makefile          # Makefile –Ω–∞ –≤–µ—Ä—Ö–Ω–µ–º —É—Ä–æ–≤–Ω–µ
‚îî‚îÄ‚îÄ ehatrom/          # –ò—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥ Rust-–ø—Ä–æ–µ–∫—Ç–∞
    ‚îú‚îÄ‚îÄ Cargo.toml
    ‚îî‚îÄ‚îÄ src/
        ‚îî‚îÄ‚îÄ lib.rs
```

---

### üêã Dockerfile

–í –ø–∞–ø–∫–µ `ehatrom/` —Å–æ–∑–¥–∞—ë–º `Dockerfile` –¥–ª—è –æ–∫—Ä—É–∂–µ–Ω–∏—è —Å nightly Rust –∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–º–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏:

```Dockerfile
FROM rustlang/rust:nightly

WORKDIR /ehatrom

RUN rustup component add rustfmt clippy
```

–°–æ–∑–¥–∞—ë–º –æ–±—Ä–∞–∑:

```bash
docker build -t ehatrom-ci ./ehatrom
```

---

### üõ†Ô∏è Makefile

–ù–∞ —É—Ä–æ–≤–µ–Ω—å –≤—ã—à–µ (–≤ `project-root/`) —Å–æ–∑–¥–∞—ë–º `Makefile`, —á—Ç–æ–±—ã —É–ø—Ä–æ—Å—Ç–∏—Ç—å —Å–±–æ—Ä–∫—É –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:

```makefile
build:
	docker build -t ehatrom-ci ./ehatrom

ci:
	docker run --rm -it \
		-v "$(PWD)/ehatrom":/ehatrom \
		-w /ehatrom \
		ehatrom-ci \
		bash -c "cargo +nightly clippy --workspace --all-targets -- -D warnings && \
		         cargo build --workspace --all-targets --verbose && \
		         cargo test --workspace --all-targets --verbose"
```

---

### üöÄ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

–¢–µ–ø–µ—Ä—å –º—ã –º–æ–∂–µ–º:

* –ü–æ—Å—Ç—Ä–æ–∏—Ç—å Docker-–æ–±—Ä–∞–∑:

  ```bash
  make build
  ```

* –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–µ–∫—Ç:

  ```bash
  make ci
  ```

---

### ‚úÖ –ß—Ç–æ –¥–µ–ª–∞–µ—Ç `make ci`

–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –∑–∞–ø—É—Å–∫–∞–µ—Ç —Å–ª–µ–¥—É—é—â—É—é —Ü–µ–ø–æ—á–∫—É –∫–æ–º–∞–Ω–¥:

```bash
cargo +nightly clippy --workspace --all-targets -- -D warnings
cargo build --workspace --all-targets --verbose
cargo test --workspace --all-targets --verbose
```

–≠—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç:

* —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Å—Ç–∏–ª—é –∫–æ–¥–∞ (—á–µ—Ä–µ–∑ `clippy`);
* —É—Å–ø–µ—à–Ω—É—é —Å–±–æ—Ä–∫—É –≤—Å–µ—Ö —Ü–µ–ª–µ–π;
* –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏–µ –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤.

---

### üß™ –í—ã–≤–æ–¥

–¢–∞–∫–æ–π –ø–æ–¥—Ö–æ–¥ –ø–æ–ª–µ–∑–µ–Ω, –µ—Å–ª–∏:

* –∫–æ–º–∞–Ω–¥–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ —Ä–∞–∑–Ω—ã—Ö –û–°;
* –≤—ã —Ö–æ—Ç–∏—Ç–µ –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é –≤–µ—Ä—Å–∏—é toolchain;
* –Ω—É–∂–Ω–æ –ª–µ–≥–∫–æ –∑–∞–ø—É—Å–∫–∞—Ç—å CI-–¥–∂–æ–±—ã –ª–æ–∫–∞–ª—å–Ω–æ.

–¢–∞–∫–∂–µ –æ–Ω —Ö–æ—Ä–æ—à–æ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ—Ç—Å—è –≤ –±–æ–ª–µ–µ —Å–ª–æ–∂–Ω—ã–µ –ø–∞–π–ø–ª–∞–π–Ω—ã –∏ –º–æ–∂–µ—Ç –±—ã—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω –≤ GitHub Actions, GitLab CI –∏–ª–∏ Drone CI.
