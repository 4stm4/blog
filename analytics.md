# События аналитики

Описание событий PostHog, которые отправляет блог. Все события отправляются только при доступности `window.posthog` и без идентификации пользователей.

## article_view
- **Когда**: на страницах с макетом `post` сразу после загрузки, с повторными попытками до готовности PostHog.
- **Зачем**: фиксирует факт просмотра статьи.
- **Поля**:
  - `slug`: slug статьи или её URL.
  - `path`: относительный путь страницы.
  - `categories`: список категорий статьи.
  - `title`: заголовок статьи.

## article_read_75
- **Когда**: на страницах статей при достижении 75% прокрутки.
- **Зачем**: понимаем, читают ли материал дальше первого экрана.
- **Поля**: те же, что и у `article_view` (`slug`, `path`, `categories`, `title`).

## copy_code
- **Когда**: при успешном копировании фрагмента кода через существующие кнопки копирования.
- **Зачем**: измерение востребованности кодовых примеров.
- **Поля**: нет.

## pageview
- **Когда**: один раз при загрузке любой страницы.
- **Зачем**: базовая метрика посещаемости с сохранением источников трафика.
- **Поля**:
  - `path`: относительный путь.
  - `url`: полный URL.
  - `referrer`: `document.referrer`, если есть.
  - `utm_source`, `utm_medium`, `utm_campaign`, `utm_content`, `utm_term`, `ref`: пробрасываются, если присутствуют в query-параметрах. Дополнительно эти значения регистрируются через `posthog.register`, чтобы прилипали к последующим событиям.

## nav_click
- **Когда**: при клике по пунктам главного меню навигации.
- **Зачем**: понять, какие разделы востребованы.
- **Поля**:
  - `label`: текст ссылки или `data-i18n`.
  - `href`: цель перехода.
  - `path`: страница, на которой был клик.

## footer_cta_click
- **Когда**: при клике по ссылкам в блоке CTA футера (категории, написать автору, подписка).
- **Зачем**: оценить востребованность callback- и subscribe-точек.
- **Поля**: аналогичны `nav_click` (`label`, `href`, `path`).

## language_switch
- **Когда**: при ручном переключении языка через кнопки RU/EN (исключая повторный выбор текущего языка).
- **Зачем**: измерить интерес к локализациям.
- **Поля**:
  - `from`: предыдущий язык.
  - `to`: выбранный язык.
  - `path`: страница, где произошёл клик.

## home_scroll_75
- **Когда**: на главной странице (`layout: home`) при достижении 75% прокрутки.
- **Зачем**: видеть вовлечённость в листинг постов и блоки на главной.
- **Поля**:
  - `path`: `/` (или локальный путь, если блог развёрнут не в корне).

## categories_scroll_75
- **Когда**: на странице `/categories/` при достижении 75% прокрутки.
- **Зачем**: понять, дочитывают ли посетители страницу с подборками.
- **Поля**: `path`.

## rsvp_opened
- **Когда**: однократно за сессию при первом открытии панели скорочтения.
- **Зачем**: фиксирует интерес к режиму скорочтения.
- **Поля**: нет.

## rsvp_play
- **Когда**: при запуске воспроизведения текста в режиме скорочтения.
- **Зачем**: понимаем фактическое использование режима скорочтения.
- **Поля**: нет.

## outbound_github_click
- **Когда**: при клике по любой ссылке на `github.com` со страниц статей.
- **Зачем**: связывает интерес к материалу с переходами в связанные репозитории.
- **Поля**:
  - `repo`: репозиторий в формате `owner/name`, если удалось разобрать путь.
  - `section`: относительный путь статьи, из которой совершен переход.
  - `url`: полный URL, по которому кликнул пользователь.

---

## Фичфлаги
- `window.blogFeatureFlags.flags`: массив активных флагов после загрузки feature flags в PostHog.
- `window.blogFeatureFlags.isEnabled('flag')`: утилита для будущих A/B-тестов.
- Дополнительно body получает атрибут `data-feature-flags="flag-a flag-b"`, чтобы можно было применять стили по флагам.
